name: "units-test"
on:
  pull_request:
  push:
    branches:
      - main
      - "releases/*"

env:
  DEPLOYER_KEYPAIR: ${{ secrets.DEPLOYER_KEYPAIR }}

jobs:
  # unit tests
  units:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: yarn
      - run: yarn build

  # test action works running from the graph
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/action.yml
        with:
          network-url: "https://api.devnet.solana.com"
          multisig-pda: "Aumm6P4VT4RcZUspSBRRkTYt2RFCWVfUhci23LrFNfZC"
          multisig-vault-index: "1"
          program-id: "example-program-id"
          buffer: "Hs93mJ3HC9qJz6ttpGGk12piv1bVxndv1RE86t585Duj"
          spill-address: "FU2pN8qudMjtBCnU6QAavsvhZFTgXrdJ8JkLRArRuZ4n"
          name: "Test Upgrade"
          keypair: ${{ secrets.DEPLOYER_KEYPAIR }}
